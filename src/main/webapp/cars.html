<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    </head>
    <body>
        <table class="table">
            <thead id="headers">
                <tr>
                </tr>
            </thead>
            <tbody id="tbody">

            </tbody>
        </table>

        <input type="text" id="price" name="price">
        <button id="filterPrice" onclick="findPrice()">Price less than</button>
        
        <button id="sortByYear" onclick="sortCars()">Sort</button>
        <script>
            getCars();
            
            function getAllData(){
                var URL = "api/cars/all";
                fetch(URL)
                        .then(res => res.json())
                        .then(data => (data));
            }
            
            function getCars() {
                
                document.getElementById("tbody").value = "";
                fetch("api/cars/all")
                        .then(res => res.json())
                        .then(data => {
                            line = "<table class=\"table table-dark\">" + "<thead class=\"thead-dark\">" + "<tr>" + "<th scope=\"col\">ID</th>" + "<th scope=\"col\">Year</th>"
                                    + "<th scope=\"col\">Make</th>" + "<th scope=\"col\">Model</th>" + "<th scope=\"col\">Price</th>" + "</tr>" + "</thead>" + "<tbody>"
                            var cars = data.map((c) => {
                                line = line + "<tr>" + "<td>" + c.id + "</td>" + "<td>" + c.year + "</td>" + "<td>" + c.make + "</td>" +
                                        "<td>" + c.model + "</td>" + "<td>" + c.price + "</td>" + "</tr>"
                                return line;
                            })
                            line = line + "</tr>" + "</tbody>" + "</table>"
                            document.getElementById("tbody").innerHTML = line;
                        });
            }

            function findPrice() {
                var lowPrice = [];
                fetch("api/cars/all")
                        .then(res => res.json())
                        .then(data => {
                            var test = data.map((t) => {
                                if (t.price < document.getElementById("price").value) {
                                    lowPrice.push(t);
                                }
                            })
                            var newCars = lowPrice;
                            line = "<table class=\"table table-dark\">" + "<thead class=\"thead-dark\">" + "<tr>" + "<th scope=\"col\">ID</th>" + "<th scope=\"col\">Year</th>"
                                    + "<th scope=\"col\">Make</th>" + "<th scope=\"col\">Model</th>" + "<th scope=\"col\">Price</th>" + "</tr>" + "</thead>" + "<tbody>"
                            newCars = lowPrice.map((c) => {
                                line = line + "<tr>" + "<td>" + c.id + "</td>" + "<td>" + c.year + "</td>" + "<td>" + c.make + "</td>" +
                                        "<td>" + c.model + "</td>" + "<td>" + c.price + "</td>" + "</tr>"
                                return line;
                            })
                            line = line + "</tr>" + "</tbody>" + "</table>"
                            document.getElementById("tbody").innerHTML = line;
                        }
                        )
            }
            
            
            function sortCars() {
                var URL = "api/cars/all";
                var newArr = []
                line = "<table class=\"table table-dark\">" + "<thead class=\"thead-dark\">" + "<tr>" + "<th scope=\"col\">ID</th>" + "<th scope=\"col\">Year</th>"
                                    + "<th scope=\"col\">Make</th>" + "<th scope=\"col\">Model</th>" + "<th scope=\"col\">Price</th>" + "</tr>" + "</thead>" + "<tbody>"
                fetch(URL)
                        .then(res => res.json())
                        .then(data => {
                             newArr = data.map(d => "<tr><td>" + d.id + "</td> <td>" + d.year + "</td> <td>" + d.make + "</td> <td>" + d.model + "</td> <td>" + d.price + "</td> </tr>")
                            newArr.sort(function (a, b) {
                                console.log(a.year - b.year);
                            })
                            let joined = line + newArr.join("")
                            document.getElementById("tbody").innerHTML = joined
                            
        })
            }
        </script>
        <br>
        <br>
        <a href="index.html">Index</a>
    </body>
</html>
