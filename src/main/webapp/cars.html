<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    </head>
    <body>
        <table class="table" id="trHeader">
            <thead>
                <tr>
                    <th id="test">id</th>
                    <th>year</th>
                    <th>make</th>
                    <th>model</th>
                    <th>price</th>
                </tr>
            </thead>
            <tbody id="values">
            </tbody>
        </table>


        <input type="text" id="price" name="price">
        <button id="filterPrice" onclick="getCars()">Price less than</button>

        <input type="text" id="year" name="price">
        <button id="filterPrice" onclick="getCars()">Price less than</button>


        <input type="text" id="price" name="price">
        <button id="filterPrice" onclick="findPrice()">Price less than</button>


        <button id="sortByYear" onclick="sortCars()">Sort by year</button>
        <script>
            getCars();
            var URL = "api/cars/all";

            function getCars(cars) {

                document.getElementById("values").value = "";
                fetch("api/cars/all")
                        .then(res => res.json())
                        .then(data => {

                            console.log("-------------------------------------------------------" + data[1].name)
                            line = "<table class=\"table table-dark\">" + "<thead class=\"thead-dark\">" + "<tr>" + "<th scope=\"col\">ID</th>" + "<th scope=\"col\">Year</th>"
                                    + "<th scope=\"col\">Make</th>" + "<th scope=\"col\">Model</th>" + "<th scope=\"col\">Price</th>" + "</tr>" + "</thead>" + "<tbody>"

                            var cars = data.map((c) => {
                                return "<tr><td>" + c.id + "</td> <td>" + c.year + "</td> <td>" + c.make + "</td> <td>" + c.model + "</td> <td>" + c.price + "</td> </tr>";
                            })

                            cars = line + "</tr>" + "</tbody>" + "</table>"
                            console.log(cars)
                            document.getElementById("tbody").innerHTML = line;

                            const joined = cars.join("");
                            document.getElementById("values").innerHTML = joined;

                        });
            }

            function findPrice() {
                console.log(document.getElementById("price").value)

                var lowPrice = [];

                for (var i = 0; i < cars.length; i++) {
                    if (cars[i].price < document.getElementById("price").value) {
                        lowPrice.push(cars[i]);
                    }
                }
                console.log(lowPrice);
                cars = lowPrice;
                displayCars();


                fetch("api/cars/all")
                        .then(res => res.json())
                        .then(data => {
                            data.map((c) => {
                                if (c.price < document.getElementById("price").value) {
                                    lowPrice.push(c);
                                }
                            })
                            lowPrice = lowPrice.map((c) => {
                                return "<tr><td>" + c.id + "</td> <td>" + c.year + "</td> <td>" + c.make + "</td> <td>" + c.model + "</td> <td>" + c.price + "</td> </tr>";
                            })
                            const joined = lowPrice.join("");
                            document.getElementById("values").innerHTML = joined;
                        }
                        )

            }



            function sortCars() {
                document.getElementById("values").value = "";
                var sorted = []
                fetch(URL)
                        .then(res => res.json())
                        .then(data => {
                            data.map((c) => {
                                sorted.push(c);
                            })
                            sorted.sort((a, b) => a.year - b.year)
                            document.getElementById("values").innerHTML = sorted.map((c) => {
                                return "<tr><td>" + c.id + "</td> <td>" + c.year + "</td> <td>" + c.make + "</td> <td>" + c.model + "</td> <td>" + c.price + "</td> </tr>";
                            }).join("")
                            console.log(sorted);
                        })
            }


        </script>
        <br>
        <br>
        <a href="index.html">Index</a>
    </body>
</html>
